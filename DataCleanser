import sys, os, re, requests
sys.path.append("C:\\Users\\flawrence\\Documents\\Projects\\pythonLibs\\ctd-python-libs")
import spreadsheets as s
from pathlib import Path
from datetime import date
from prompt_toolkit.shortcuts import checkboxlist_dialog, radiolist_dialog, button_dialog
from bs4 import BeautifulSoup


def getSettingsInputFromUser(total):
    settingsText = "Do you want to use the following settings for all " + str(total) + " spreadsheets?"

    saveSettings = button_dialog(
    title='Bulk or Individual Settings',
    text=settingsText,
    buttons=[
        ('Yes', True),
        ('No', False)]).run() 
    
    return saveSettings
    

def getSpreadsheetInputFromUser(columns, spreadsheetTitle = ''):
    
    if spreadsheetTitle != '':
        dialogTitle = "Column Selector: " + spreadsheetTitle
    else:
        dialogTitle = "Column Selector"
    
    columnResultsArray = checkboxlist_dialog(
        title=dialogTitle,
        text="Which columns would you like to replace the text in?",
        values = [(heading, heading) for heading in columns]).run()

    columns = dict([(key, "") for key in columnResultsArray])

    for column in columnResultsArray:
        result = radiolist_dialog(
            title="Replacement Type",
            text="Replace " + column + " as:",
            values=[
                ("name", "Name"),
                ("text", "Text")
            ]
        ).run() 
        columns[column] = result
    
    return columns
    


def createNewEntries():
    pass


def newEntryGenerator():
    url = requests.get("https://en.wikipedia.org/wiki/Special:Random")
    soup = BeautifulSoup(url.content, "html.parser")
    title = soup.find(class_="firstHeading").text

    randomPage = "https://en.wikipedia.org/wiki/" + title
    print(randomPage)
    url2 = requests.get(randomPage)
    soup2 = BeautifulSoup(url2.content, "html.parser")
    content = soup.find(id="mw-content-text")
    for p in content.find_all('p'):
        if p.text.strip() != "":
            newText = p.text.strip()
            newText = re.sub('\[\d+]', '', newText) + " Ref: Wikipedia - " + title
            return newText



files = s.getFileList(Path("C:\\Users\\flawrence\\Documents\\Projects\\ctd-data-redact-by-date\\data"))

#bulk = getSettingsInputFromUser(len(files))

print(newEntryGenerator())

'''
userInputBySheet = {}
if bulk:
    spreadsheetValues = s.getSpreadsheetValues(files[0])
    userInput = getSpreadsheetInputFromUser(list(spreadsheetValues.keys()))
else:
    for index, file in enumerate(files):
        spreadsheetValues = s.getSpreadsheetValues(file)
        spreadsheetName = os.path.splitext(os.path.basename(file))[0] + " (" + str(index + 1) + "/" + str(len(files)) + ")"
        userInputBySheet[spreadsheetName] = getSpreadsheetInputFromUser(list(spreadsheetValues.keys()), spreadsheetName)


if len(userInputBySheet) == 0:
    print(userInput)
else:
    print(userInputBySheet)

'''


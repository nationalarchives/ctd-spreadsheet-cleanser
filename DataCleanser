import sys, os
sys.path.append("C:\\Users\\flawrence\\Documents\\Projects\\pythonLibs\\ctd-python-libs")
import spreadsheets as s
from pathlib import Path
from datetime import date
from prompt_toolkit.shortcuts import checkboxlist_dialog, radiolist_dialog, button_dialog
import requests
from bs4 import BeautifulSoup


def getSettingsInputFromUser(total):
    settingsText = "Do you want to use the following settings for all " + str(total) + " spreadsheets?"

    saveSettings = button_dialog(
    title='Bulk or Individual Settings',
    text=settingsText,
    buttons=[
        ('Yes', True),
        ('No', False)]).run() 
    
    return saveSettings
    



def getSpreadsheetInputFromUser(columns, spreadsheetTitle = ''):
    
    if spreadsheetTitle != '':
        dialogTitle = "Column Selector: " + spreadsheetTitle
    else:
        dialogTitle = "Column Selector"
    
    columnResultsArray = checkboxlist_dialog(
        title=dialogTitle,
        text="Which columns would you like to replace the text in?",
        values = [(heading, heading) for heading in columns]).run()

    columns = dict([(key, "") for key in columnResultsArray])

    for column in columnResultsArray:
        result = radiolist_dialog(
            title="Replacement Type",
            text="Replace " + column + " as:",
            values=[
                ("name", "Name"),
                ("test", "Text")
            ]
        ).run() 
        columns[column] = result
    
    return columns
    


def createNewEntries():
    pass


def newEntryGenerator():
    pass


files = s.getFileList(Path("C:\\Users\\flawrence\\Documents\\Projects\\ctd-data-redact-by-date\\data"))

bulk = getSettingsInputFromUser(len(files))



if bulk:
    spreadsheetValues = s.getSpreadsheetValues(files[0])
    userInput = getSpreadsheetInputFromUser(list(spreadsheetValues.keys()))
else:
    userInputBySheet = {}
    for index, file in enumerate(files):
        spreadsheetValues = s.getSpreadsheetValues(file)
        spreadsheetName = os.path.splitext(os.path.basename(file))[0] + " (" + str(index + 1) + "/" + str(len(files)) + ")"
        userInputBySheet[spreadsheetName] = getSpreadsheetInputFromUser(list(spreadsheetValues.keys()), spreadsheetName)



